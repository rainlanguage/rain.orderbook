{"version":3,"file":"_page.svelte.js","sources":["../../../../../../../../node_modules/flowbite-svelte/dist/typography/Heading.svelte","../../../../../../../../packages/ui-components/dist/components/tables/VaultBalanceChangesTable.svelte","../../../../../../../../packages/ui-components/dist/components/detail/VaultDetail.svelte","../../../../../../../src/routes/vaults/[chainId]-[orderbook]-[id]/+page.svelte"],"sourcesContent":["<script>import { twMerge } from 'tailwind-merge';\nexport let tag = 'h1';\nexport let color = 'text-gray-900 dark:text-white';\nexport let customSize = '';\nconst textSizes = {\n    h1: 'text-5xl font-extrabold',\n    h2: 'text-4xl font-bold',\n    h3: 'text-3xl font-bold',\n    h4: 'text-2xl font-bold',\n    h5: 'text-xl font-bold',\n    h6: 'text-lg font-bold'\n};\n</script>\n\n<svelte:element this={tag} {...$$restProps} class={twMerge(customSize ? customSize : textSizes[tag], color, 'w-full', $$props.class)}>\n  <slot />\n</svelte:element>\n\n<!--\n@component\n[Go to docs](https://flowbite-svelte.com/)\n## Props\n@prop export let tag: 'h1' | 'h2' | 'h3' | 'h4' | 'h5' | 'h6' = 'h1';\n@prop export let color: string = 'text-gray-900 dark:text-white';\n@prop export let customSize: string = '';\n-->\n","<script>import { Heading, TableHeadCell, TableBodyCell } from \"flowbite-svelte\";\nimport { createInfiniteQuery } from \"@tanstack/svelte-query\";\nimport { RaindexVault } from \"@rainlanguage/orderbook\";\nimport { formatTimestampSecondsAsLocal } from \"../../services/time\";\nimport Hash, { HashType } from \"../Hash.svelte\";\nimport { QKEY_VAULT_CHANGES } from \"../../queries/keys\";\nimport { DEFAULT_PAGE_SIZE } from \"../../queries/constants\";\nimport TanstackAppTable from \"../TanstackAppTable.svelte\";\nexport let vault;\n$: balanceChangesQuery = createInfiniteQuery({\n  queryKey: [vault.id, QKEY_VAULT_CHANGES + vault.id],\n  queryFn: async ({ pageParam }) => {\n    const result = await vault.getBalanceChanges(pageParam + 1);\n    if (result.error) throw new Error(result.error.msg);\n    return result.value;\n  },\n  initialPageParam: 0,\n  getNextPageParam(lastPage, _allPages, lastPageParam) {\n    return lastPage.length === DEFAULT_PAGE_SIZE ? lastPageParam + 1 : void 0;\n  }\n});\nconst AppTable = TanstackAppTable;\n</script>\n\n<AppTable\n\tquery={balanceChangesQuery}\n\tqueryKey={vault.id}\n\temptyMessage=\"No deposits or withdrawals found\"\n\trowHoverable={false}\n>\n\t<svelte:fragment slot=\"title\">\n\t\t<Heading tag=\"h5\" class=\"mb-4 mt-6 font-normal\">Vault balance changes</Heading>\n\t</svelte:fragment>\n\t<svelte:fragment slot=\"head\">\n\t\t<TableHeadCell padding=\"p-4\">Date</TableHeadCell>\n\t\t<TableHeadCell padding=\"p-0\">Sender</TableHeadCell>\n\t\t<TableHeadCell padding=\"p-0\">Transaction Hash</TableHeadCell>\n\t\t<TableHeadCell padding=\"p-0\">Balance Change</TableHeadCell>\n\t\t<TableHeadCell padding=\"p-0\">Balance</TableHeadCell>\n\t\t<TableHeadCell padding=\"p--\">Type</TableHeadCell>\n\t</svelte:fragment>\n\n\t<svelte:fragment slot=\"bodyRow\" let:item>\n\t\t<TableBodyCell tdClass=\"px-4 py-2\" data-testid=\"vaultBalanceChangesTableDate\">\n\t\t\t{formatTimestampSecondsAsLocal(BigInt(item.timestamp))}\n\t\t</TableBodyCell>\n\t\t<TableBodyCell tdClass=\"break-all py-2 min-w-48\" data-testid=\"vaultBalanceChangesTableFrom\">\n\t\t\t<Hash type={HashType.Wallet} value={item.transaction.from} />\n\t\t</TableBodyCell>\n\t\t<TableBodyCell tdClass=\"break-all py-2 min-w-48\" data-testid=\"vaultBalanceChangesTableTx\">\n\t\t\t<Hash type={HashType.Transaction} value={item.transaction.id} />\n\t\t</TableBodyCell>\n\t\t<TableBodyCell\n\t\t\ttdClass=\"break-word p-0 text-left\"\n\t\t\tdata-testid=\"vaultBalanceChangesTableBalanceChange\"\n\t\t>\n\t\t\t{`${item.formattedAmount} ${item.token.symbol}`}\n\t\t</TableBodyCell>\n\t\t<TableBodyCell tdClass=\"break-word p-0 text-left\" data-testid=\"vaultBalanceChangesTableBalance\">\n\t\t\t{`${item.formattedNewBalance} ${item.token.symbol}`}\n\t\t</TableBodyCell>\n\t\t<TableBodyCell tdClass=\"break-word p-0 text-left\" data-testid=\"vaultBalanceChangesTableType\">\n\t\t\t{item.type}\n\t\t</TableBodyCell>\n\t</svelte:fragment>\n</AppTable>\n","<script>import Hash, { HashType } from \"../Hash.svelte\";\nimport VaultBalanceChangesTable from \"../tables/VaultBalanceChangesTable.svelte\";\nimport TanstackPageContentDetail from \"./TanstackPageContentDetail.svelte\";\nimport CardProperty from \"../CardProperty.svelte\";\nimport { QKEY_VAULT } from \"../../queries/keys\";\nimport {\n  RaindexClient\n} from \"@rainlanguage/orderbook\";\nimport { toHex } from \"viem\";\nimport { createQuery } from \"@tanstack/svelte-query\";\nimport { onDestroy } from \"svelte\";\nimport { useQueryClient } from \"@tanstack/svelte-query\";\nimport OrderOrVaultHash from \"../OrderOrVaultHash.svelte\";\nimport Refresh from \"../icon/Refresh.svelte\";\nimport { invalidateTanstackQueries } from \"../../queries/queryClient\";\nimport { useAccount } from \"../../providers/wallet/useAccount\";\nimport { Button } from \"flowbite-svelte\";\nimport {\n  ArrowDownToBracketOutline,\n  ArrowUpFromBracketOutline,\n  WalletOutline\n} from \"flowbite-svelte-icons\";\nimport { getExplorerLink } from \"../../services/getExplorerLink\";\nimport { useToasts } from \"../../providers/toasts/useToasts\";\nimport { useRaindexClient } from \"../../hooks/useRaindexClient\";\nexport let id;\nexport let orderbookAddress;\nexport let chainId;\nexport let onDeposit;\nexport let onWithdraw;\nconst queryClient = useQueryClient();\nconst { matchesAccount } = useAccount();\nconst { errToast } = useToasts();\nconst raindexClient = useRaindexClient();\n$: vaultDetailQuery = createQuery({\n  queryKey: [id, QKEY_VAULT + id],\n  queryFn: async () => {\n    const result = await raindexClient.getVault(chainId, orderbookAddress, id);\n    if (result.error) throw new Error(result.error.readableMsg);\n    return result.value;\n  }\n});\nconst interval = setInterval(async () => {\n  invalidateTanstackQueries(queryClient, [id, QKEY_VAULT + id]);\n}, 5e3);\nonDestroy(() => {\n  clearInterval(interval);\n});\nconst handleRefresh = async () => {\n  try {\n    await invalidateTanstackQueries(queryClient, [id, QKEY_VAULT + id]);\n  } catch {\n    errToast(\"Failed to refresh\");\n  }\n};\n</script>\n\n<TanstackPageContentDetail query={vaultDetailQuery} emptyMessage=\"Vault not found\">\n\t<svelte:fragment slot=\"top\" let:data>\n\t\t<div\n\t\t\tdata-testid=\"vaultDetailTokenName\"\n\t\t\tclass=\"flex gap-x-4 text-3xl font-medium dark:text-white\"\n\t\t>\n\t\t\t{data.token.name}\n\t\t</div>\n\t\t<div class=\"flex items-center gap-2\">\n\t\t\t{#if matchesAccount(data.owner)}\n\t\t\t\t<Button\n\t\t\t\t\tcolor=\"light\"\n\t\t\t\t\tsize=\"xs\"\n\t\t\t\t\tdata-testid=\"deposit-button\"\n\t\t\t\t\taria-label=\"Deposit to vault\"\n\t\t\t\t\ton:click={() => onDeposit(raindexClient, data)}\n\t\t\t\t>\n\t\t\t\t\t<ArrowDownToBracketOutline size=\"xs\" />\n\t\t\t\t</Button>\n\t\t\t\t<Button\n\t\t\t\t\tcolor=\"light\"\n\t\t\t\t\tsize=\"xs\"\n\t\t\t\t\tdata-testid=\"withdraw-button\"\n\t\t\t\t\taria-label=\"Withdraw from vault\"\n\t\t\t\t\ton:click={() => onWithdraw(raindexClient, data)}\n\t\t\t\t>\n\t\t\t\t\t<ArrowUpFromBracketOutline size=\"xs\" />\n\t\t\t\t</Button>\n\t\t\t{/if}\n\n\t\t\t<Refresh\n\t\t\t\ttestId=\"top-refresh\"\n\t\t\t\ton:click={handleRefresh}\n\t\t\t\tspin={$vaultDetailQuery.isLoading || $vaultDetailQuery.isFetching}\n\t\t\t/>\n\t\t</div>\n\t</svelte:fragment>\n\t<svelte:fragment slot=\"card\" let:data>\n\t\t<CardProperty data-testid=\"vaultDetailVaultId\">\n\t\t\t<svelte:fragment slot=\"key\">Vault ID</svelte:fragment>\n\t\t\t<svelte:fragment slot=\"value\">{toHex(data.vaultId)}</svelte:fragment>\n\t\t</CardProperty>\n\n\t\t<CardProperty data-testid=\"vaultDetailOrderbookAddress\">\n\t\t\t<svelte:fragment slot=\"key\">Orderbook</svelte:fragment>\n\t\t\t<svelte:fragment slot=\"value\">\n\t\t\t\t<Hash type={HashType.Identifier} value={data.orderbook} />\n\t\t\t</svelte:fragment>\n\t\t</CardProperty>\n\n\t\t<CardProperty data-testid=\"vaultDetailOwnerAddress\">\n\t\t\t<svelte:fragment slot=\"key\">Owner address</svelte:fragment>\n\t\t\t<svelte:fragment slot=\"value\">\n\t\t\t\t{@const explorerLink = getExplorerLink(data.owner, chainId, 'address')}\n\t\t\t\t{#if explorerLink}\n\t\t\t\t\t<a\n\t\t\t\t\t\thref={explorerLink}\n\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\t\t\tclass=\"flex items-center justify-start space-x-2 text-left text-blue-500 hover:underline\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<WalletOutline size=\"sm\" />\n\t\t\t\t\t\t<span>{data.owner}</span>\n\t\t\t\t\t</a>\n\t\t\t\t{:else}\n\t\t\t\t\t<Hash type={HashType.Wallet} value={data.owner} />\n\t\t\t\t{/if}\n\t\t\t</svelte:fragment>\n\t\t</CardProperty>\n\n\t\t<CardProperty data-testid=\"vaultDetailTokenAddress\">\n\t\t\t<svelte:fragment slot=\"key\">Token address</svelte:fragment>\n\t\t\t<svelte:fragment slot=\"value\">\n\t\t\t\t<Hash value={data.token.id} />\n\t\t\t</svelte:fragment>\n\t\t</CardProperty>\n\n\t\t<CardProperty data-testid=\"vaultDetailBalance\">\n\t\t\t<svelte:fragment slot=\"key\">Balance</svelte:fragment>\n\t\t\t<svelte:fragment slot=\"value\"\n\t\t\t\t>{`${data.formattedBalance} ${data.token.symbol}`}</svelte:fragment\n\t\t\t>\n\t\t</CardProperty>\n\n\t\t<CardProperty>\n\t\t\t<svelte:fragment slot=\"key\">Orders as input</svelte:fragment>\n\t\t\t<svelte:fragment slot=\"value\">\n\t\t\t\t<p data-testid=\"vaultDetailOrdersAsInput\" class=\"flex flex-wrap justify-start\">\n\t\t\t\t\t{#if data.ordersAsInput && data.ordersAsInput.length > 0}\n\t\t\t\t\t\t{#each data.ordersAsInput as order}\n\t\t\t\t\t\t\t<OrderOrVaultHash type=\"orders\" orderOrVault={order} {chainId} {orderbookAddress} />\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t{:else}\n\t\t\t\t\t\tNone\n\t\t\t\t\t{/if}\n\t\t\t\t</p>\n\t\t\t</svelte:fragment>\n\t\t</CardProperty>\n\n\t\t<CardProperty>\n\t\t\t<svelte:fragment slot=\"key\">Orders as output</svelte:fragment>\n\t\t\t<svelte:fragment slot=\"value\">\n\t\t\t\t<p data-testid=\"vaultDetailOrdersAsOutput\" class=\"flex flex-wrap justify-start\">\n\t\t\t\t\t{#if data.ordersAsOutput && data.ordersAsOutput.length > 0}\n\t\t\t\t\t\t{#each data.ordersAsOutput as order}\n\t\t\t\t\t\t\t<OrderOrVaultHash type=\"orders\" orderOrVault={order} {chainId} {orderbookAddress} />\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t{:else}\n\t\t\t\t\t\tNone\n\t\t\t\t\t{/if}\n\t\t\t\t</p>\n\t\t\t</svelte:fragment>\n\t\t</CardProperty>\n\t</svelte:fragment>\n\n\t<svelte:fragment slot=\"chart\">\n\t\t<!-- TODO: Issue #1989: VaultBalanceChart temporarily disabled -->\n\t\t<!-- <VaultBalanceChart /> -->\n\t</svelte:fragment>\n\n\t<svelte:fragment slot=\"below\" let:data><VaultBalanceChangesTable vault={data} /></svelte:fragment>\n</TanstackPageContentDetail>\n","<script lang=\"ts\">\n  import { invalidateTanstackQueries, PageHeader } from '@rainlanguage/ui-components';\n  import { page } from '$app/stores';\n  import { VaultDetail } from '@rainlanguage/ui-components';\n  // TODO: Issue #1989\n  // import { lightweightChartsTheme } from '$lib/stores/darkMode';\n  import { handleDepositModal, handleWithdrawModal } from '$lib/services/modal';\n  import type { Address, Hex, RaindexClient, RaindexVault } from '@rainlanguage/orderbook';\n  import { useQueryClient } from '@tanstack/svelte-query';\n  import { getAllContexts } from 'svelte';\n\n  const context = getAllContexts();\n\n  const { chainId, orderbook, id } = $page.params;\n  const parsedId = id as Hex;\n  const parsedChainId = Number(chainId);\n  const orderbookAddress = orderbook as Address;\n\n  const queryClient = useQueryClient();\n\n  function onDeposit(_raindexClient: RaindexClient, vault: RaindexVault) {\n    handleDepositModal(\n      vault,\n      () => {\n        invalidateTanstackQueries(queryClient, [$page.params.id]);\n      },\n      context,\n    );\n  }\n\n  function onWithdraw(_raindexClient: RaindexClient, vault: RaindexVault) {\n    handleWithdrawModal(\n      vault,\n      () => {\n        invalidateTanstackQueries(queryClient, [$page.params.id]);\n      },\n      context,\n    );\n  }\n</script>\n\n<PageHeader title=\"Vault\" pathname={$page.url.pathname} />\n\n<VaultDetail chainId={parsedChainId} {orderbookAddress} id={parsedId} {onDeposit} {onWithdraw} />\n"],"names":[],"mappings":"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","x_google_ignoreList":[0]}