{"version":3,"file":"time.js","sources":["../../../../../packages/ui-components/dist/services/time.js"],"sourcesContent":["import dayjs from 'dayjs';\nimport bigIntSupport from 'dayjs/plugin/bigIntSupport';\nimport localizedFormat from 'dayjs/plugin/localizedFormat';\nimport utc from 'dayjs/plugin/utc';\ndayjs.extend(bigIntSupport);\ndayjs.extend(localizedFormat);\ndayjs.extend(utc);\nexport const TIME_DELTA_24_HOURS = 60 * 60 * 24;\nexport const TIME_DELTA_48_HOURS = TIME_DELTA_24_HOURS * 2;\nexport const TIME_DELTA_7_DAYS = TIME_DELTA_24_HOURS * 7;\nexport const TIME_DELTA_30_DAYS = TIME_DELTA_24_HOURS * 30;\nexport const TIME_DELTA_1_YEAR = TIME_DELTA_24_HOURS * 365;\nexport function dateTimestamp(date) {\n    return Math.floor(date.getTime() / 1000);\n}\nexport function formatTimestampSecondsAsLocal(timestampSeconds) {\n    return dayjs(timestampSeconds * BigInt('1000'))\n        .utc()\n        .format('L LT');\n}\nexport function timestampSecondsToUTCTimestamp(timestampSeconds) {\n    return dayjs(timestampSeconds * BigInt('1000')).unix();\n}\n/**\n * Method to put a timeout on a promise, throws the exception if promise is not settled within the time\n * @param promise - The original promise\n * @param time - The time in ms\n * @param exception - The exception to reject with if time runs out before original promise settlement\n * @returns A new promise that gets settled with initial promise settlement or rejected with exception value\n * if the time runs out before the main promise settlement\n */\nexport async function promiseTimeout(promise, time, exception) {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    let timeout;\n    return Promise.race([\n        promise,\n        new Promise((_resolve, reject) => (timeout = setTimeout(reject, time, exception)))\n    ]).finally(() => clearTimeout(timeout));\n}\nif (import.meta.vitest) {\n    const { describe, it, expect, vi } = import.meta.vitest;\n    describe('Date and timestamp utilities', () => {\n        describe('formatTimestampSecondsAsLocal', () => {\n            it('converts timestamp to local format', () => {\n                const result = formatTimestampSecondsAsLocal(BigInt('1672531200')); // Jan 1, 2023 12:00 AM\n                expect(result).toBe('01/01/2023 12:00 AM');\n            });\n        });\n        describe('timestampSecondsToUTCTimestamp', () => {\n            it('converts bigint timestamp to UTCTimestamp', () => {\n                const result = timestampSecondsToUTCTimestamp(BigInt('1672531200'));\n                expect(result).toBe(1672531200);\n            });\n        });\n    });\n    describe('promiseTimeout', () => {\n        it('resolves when promise resolves before timeout', async () => {\n            const testValue = 'test';\n            const promise = Promise.resolve(testValue);\n            const result = await promiseTimeout(promise, 100, new Error('Timeout'));\n            expect(result).toBe(testValue);\n        });\n        it('rejects when promise times out', async () => {\n            const promise = new Promise((resolve) => setTimeout(resolve, 200));\n            const exception = new Error('Timeout');\n            await expect(promiseTimeout(promise, 100, exception)).rejects.toThrow(exception);\n        });\n        it('rejects when original promise rejects', async () => {\n            const error = new Error('Original rejection');\n            const promise = Promise.reject(error);\n            await expect(promiseTimeout(promise, 100, new Error('Timeout'))).rejects.toThrow(error);\n        });\n        it('clears timeout after promise resolution', async () => {\n            vi.spyOn(global, 'clearTimeout');\n            const promise = Promise.resolve('test');\n            await promiseTimeout(promise, 100, new Error('Timeout'));\n            expect(clearTimeout).toHaveBeenCalled();\n        });\n        it('clears timeout after promise rejection', async () => {\n            vi.spyOn(global, 'clearTimeout');\n            const promise = Promise.reject(new Error('Original rejection'));\n            try {\n                await promiseTimeout(promise, 100, new Error('Timeout'));\n            }\n            catch {\n                // Ignore the error\n            }\n            expect(clearTimeout).toHaveBeenCalled();\n        });\n    });\n    describe('dateTimestamp', () => {\n        it('should get date timestamp in seconds', () => {\n            const date = new Date(2022, 1, 16, 17, 32, 11, 168);\n            const result = dateTimestamp(date);\n            const expected = Math.floor(date.getTime() / 1000);\n            expect(result).toEqual(expected);\n        });\n    });\n}\n"],"names":[],"mappings":";;;;AAIA,MAAM,OAAO,aAAa;AAC1B,MAAM,OAAO,eAAe;AAC5B,MAAM,OAAO,GAAG;AAST,SAAS,8BAA8B,kBAAkB;AACrD,SAAA,MAAM,mBAAmB,OAAO,MAAM,CAAC,EACzC,IAAA,EACA,OAAO,MAAM;AACtB;AACO,SAAS,+BAA+B,kBAAkB;AAC7D,SAAO,MAAM,mBAAmB,OAAO,MAAM,CAAC,EAAE,KAAK;AACzD;AASsB,eAAA,eAAe,SAAS,MAAM,WAAW;AAEvD,MAAA;AACJ,SAAO,QAAQ,KAAK;AAAA,IAChB;AAAA,IACA,IAAI,QAAQ,CAAC,UAAU,WAAY,UAAU,WAAW,QAAQ,MAAM,SAAS,CAAE;AAAA,EACpF,CAAA,EAAE,QAAQ,MAAM,aAAa,OAAO,CAAC;AAC1C;"}